<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EVENT.IO</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" type="text/css" href="public/styles/main.css">
</head>
<body>

<div class="app-layout">

    <!-- NAGŁÓWEK -->
    <header class="fixed-header-container" id="app-header">
        
        <div class="top-icons">
            <!-- USTAWIENIA -->
            <a href="/settings">
                <i class="fa-solid fa-gear"></i>
            </a>

            <!-- PROFIL -->
            <a href="/profile" title="Profil">
                <i class="fa-regular fa-circle-user"></i>
            </a>

            <!-- DASHBOARD (tylko admin) -->
            <!-- Usunięto klasę 'admin-btn', aby przycisk wyglądał tak samo jak inne -->
            <?php if (isset($_SESSION['role']) && $_SESSION['role'] === 'admin'): ?>
                <a href="/dashboard">
                    <i class="fa-solid fa-chart-line"></i>
                </a>
            <?php endif; ?>

            <!-- LOGOUT -->
            <a href="/logout">
                <i class="fa-solid fa-right-from-bracket"></i>
            </a>
        </div>

        <!-- LOGO -->
        <div class="logo-section" id="logo-section">
            <a href="/main" style="text-decoration: none;">
                <h1 class="main-logo">EVENT.IO</h1>
            </a>
        </div>

        <div class="search-section">
            <div class="search-filter-wrapper">
                <div class="search-box">
                    <i class="fa-solid fa-bars"></i>
                    <input type="text" placeholder="Hinted search text">
                    <i class="fa-solid fa-magnifying-glass search-icon"></i>
                </div>

                <div class="filter-box">
                    <div class="filter-option" id="location-filter">
                        <i class="fa-solid fa-location-dot"></i>
                        <span>Lokalizacja</span>
                    </div>
                    <div class="filter-option" id="saved-filter">
                        <i class="fa-regular fa-bookmark"></i>
                        <span>Zapisane</span>
                    </div>
                    <div class="filter-option" id="date-filter">
                        <i class="fa-regular fa-calendar"></i>
                        <span>Data</span>
                    </div>

                    <!-- Hidden filter inputs -->
                    <div id="location-input-container" class="filter-input-container" style="display: none;">
                        <input type="text" id="location-input" placeholder="Wpisz lokalizację" list="location-suggestions">
                        <datalist id="location-suggestions"></datalist>
                    </div>
                    <div id="date-input-container" class="filter-input-container" style="display: none;">
                        <input type="date" id="date-input">
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- TREŚĆ -->
    <main class="scrollable-content" id="scroll-container">
        <div class="content-padding">

            <!-- SEKCJA AKCJI I TABELI -->
            <section class="action-panel">
                <div class="panel-header">
                    <h2>WYDARZENIA</h2>
                </div>
                <div style="text-align: center; margin: 20px 0;">
                    <a href="/add-event" style="display: inline-block; width: min(350px, 90vw); padding: 15px; border: none; border-radius: 0; background-color: #dcdcdc; color: black; text-decoration: none; font-family: 'Jersey 10', sans-serif; font-size: clamp(2rem, 5vw, 2.5rem); text-transform: uppercase; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: background-color 0.2s ease, transform 0.1s ease;" onmouseover="this.style.backgroundColor='#ffffff'; this.style.transform='translateY(-2px)';" onmouseout="this.style.backgroundColor='#dcdcdc'; this.style.transform='translateY(0)';">
                        + DODAJ WYDARZENIE
                    </a>
                </div>
            </section>

            <?php foreach ($events as $event): ?>
            <article class="event-card" onclick="if (!event.target.closest('.share-btn')) window.location.href='/event-details?id=<?php echo htmlspecialchars($event->id); ?>'" style="cursor: pointer;">
                <div class="event-image">
                    <img src="<?php echo htmlspecialchars($event->imageUrl); ?>" alt="Event">
                </div>
                <div class="event-details">
                    <div class="event-header">
                        <h2><?php echo htmlspecialchars($event->title); ?></h2>
                    </div>
                    <div class="event-info">
                        <p><i class="fa-solid fa-location-dot"></i> <?php echo htmlspecialchars($event->location); ?></p>
                        <p><i class="fa-regular fa-clock"></i> <?php echo htmlspecialchars($event->date); ?></p>
                        <p><i class="fa-solid fa-info-circle"></i> Status: <?php echo htmlspecialchars($event->status); ?></p>
                    </div>
                    <div class="event-footer">
                        <div class="checkbox-wrapper" onclick="event.stopPropagation();">
                            <input type="checkbox" id="<?php echo htmlspecialchars($event->id); ?>" <?php echo isset($event->isInterested) && $event->isInterested ? 'checked' : ''; ?>>
                            <label for="<?php echo htmlspecialchars($event->id); ?>">JESTEM ZAINTERESOWANY</label>
                        </div>
                        <?php if ($event->interestCount > 0): ?>
                        <span class="interest-count">LICZBA ZAINTERESOWANYCH: <?php echo htmlspecialchars($event->interestCount); ?></span>
                        <?php endif; ?>
                        <div class="card-icons">
                            <i class="fa-solid fa-share-nodes share-btn" data-url="<?php echo htmlspecialchars('http://' . $_SERVER['HTTP_HOST'] . '/event-details?id=' . $event->id); ?>"></i>
                        </div>
                    </div>
                </div>
            </article>
            <?php endforeach; ?>

        </div>

        <!-- Dodatkowe czarne pole na dole strony -->
        <div style="height: 200px; background-color: black;"></div>
    </main>

    <!-- Message box for share -->
    <div id="share-message" class="share-message">Link skopiowany!</div>
</div>

<!-- SKRYPT ZWIJANIA HEADERA -->
<script>
    const scrollContainer = document.getElementById('scroll-container');
    const header = document.getElementById('app-header');

    scrollContainer.addEventListener('scroll', () => {
        if (scrollContainer.scrollTop > 50) {
            header.classList.add('header-shrink');
        } else {
            header.classList.remove('header-shrink');
        }
    });
</script>

<!-- EXPORT EVENTS DATA TO JS -->
<script src="public/scripts/events-data.php"></script>

<script src="public/scripts/main.js"></script>

</body>
</html>
